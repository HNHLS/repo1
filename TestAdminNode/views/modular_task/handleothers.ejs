<!DOCTYPE html>
<html>
	<% include ../layout/header.ejs %>
	<body>
		<div class="cBody">
			<form id="addForm" class="layui-form" action="">
				<div class="console" style="margin-top: 5%;">
					<div class="layui-form-item">
						<div class="layui-inline" style="position: relative;left: 25%;">
							<label class="layui-form-label"><span class="i">*</span>指派人员</label>
					    	<div class="layui-input-block">
					    		<input type="hidden" id="delegateNum" name="delegateNum" value="<%=delegateNum%>" />
					    		<select name="ProjectEngineer" id="ProjectEngineer" lay-verify="required" lay-search></select>
					    	</div>
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-inline" style="position: relative;left: 45%;">
							<button class="layui-btn" lay-submit lay-filter="formDemo">指派</button>
						</div>
					</div>
				</div>
			</form>
		</div>
	</body>
	<% include ../layout/footer.ejs %>
	<script type="text/javascript">
		layui.use(['form','jquery'], function(){
			var form = layui.form
			var $=layui.jquery
			$.ajax({
				type: "POST",
				url: "/modular_qualifications/DepartmentAndRole?role=项目工程师",
				success: function (msg) {
				    console.log(msg);
				    var data=msg.message
				    if (msg.status =="ok") {
				    	for(var i=0;i<data.length;i++){
				    		$("#ProjectEngineer").append('<option value="'+data[i].id+'">'+data[i].name+'</option>')
				    	}
						form.render("select");
				    } else {
				        alert(msg.message);
				    }
				}
			});
			//监听提交
			form.on('submit(formDemo)', function(data){
				var delegateNum=data.field.delegateNum
				var ProjectEngineer=data.field.ProjectEngineer
				console.log(data.field)
				$.ajax({
					type:"post",
					url:"/modular_task/assignTask",
					async:true,
					data:{
						delegateNum:delegateNum,
						id:ProjectEngineer 
					},
					success:function(res){
						console.log(res)
						if(res.status=="ok"){
							parent.location.href="/modular_task/taskmanagement"
							var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                			parent.layer.close(index);
						}else{
							layer.msg(res.message,{icon: 5})
						}
					}
				});
			    return false;
			});
		});
	</script>
</html>
