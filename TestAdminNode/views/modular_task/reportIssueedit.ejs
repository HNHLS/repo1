<!doctype html>
<html>
	<% include ../layout/header.ejs %>
	<style type="text/css">
		a {
			text-decoration: none;
			color: #fff;
			font-size: 12px;
		}
		
		a:focus,
		a:hover {
			color: #fff;
		}
		
		#jOrgChart {
			margin-top: 40px;
		}
		
		.jOrgChart .node {
			width: 120px;
			height: 50px;
			line-height: 35px;
			border-radius: 4px;
			margin: 0 8px;
		}
		
		#jOrg {
			/*float: left;*/
			width: 100%;
			padding: 0px 20px;
		}
		
		#tab {
			width: 100%;
			/*float: right;*/
			padding: 0px 20px;
		}
		
		#tab>div {
			width: 100%;
		}
		
		.mail {
			min-height: 200px;
		}
		
		.blueline {
			border-bottom: 1px solid #b8ddf3;
			width: 100%;
			margin-bottom: 20px;
		}
		
		.blueline .title {
			background-color: #75bde6;
			color: white;
			padding: 6px 0px;
			width: 90px;
			text-align: center;
			font-size: 12px;
			border-radius: 8px 8px 0 0;
		}
		
		.layui-input-block {
			line-height: 36px;
		}
		/*数字框去除箭头*/
		input::-webkit-outer-spin-button,
		input::-webkit-inner-spin-button {
		    -webkit-appearance: none;
		}
		 
		input[type="number"] {
		    -moz-appearance: textfield;
		}
		/*组件/层压件材料信息*/
		.layui-tab-item .layui-form-label{
			padding-top: 0px;
		}
		.synchro{
			float: right;
			height: 28px;
		}
		.sampleNum{
			display: inline-block;
		}
		.selectedsample{
			display: inline-block;
			border: 1px solid #37a3dd;
			padding:3px 7px;
			border-radius: 5px;
			margin-left: 5px;
		}
	</style>
	<body>
		<div class="cBody">
			<form id="addForm" class="layui-form" action="">
				<div class="toolbtn">
					<div class="layui-btn layui-btn-sm return" onclick="golist()"><i class="iconfont icon-fanhui"></i>返回列表</div>
					<div class="layui-btn layui-btn-sm" data-type="assign"><i class="iconfont icon-xiafa"></i>确认签发</div>
					<!--<div class="layui-btn layui-btn-sm save" data-type="save"><i class="iconfont icon-baocun"></i>保存</div>-->
				</div>
				<div id="task">
					<div class="entrust">
						<div class="blueline">
							<div class="title"> 
								基础信息
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">检测依据:</label>
								<div class="layui-input-block">
									<span><%=basicInfo.testStandard%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">判定依据:</label>
								<div class="layui-input-block">
									<span><%=basicInfo.judgeStandard%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">检测项目:</label>
								<div class="layui-input-block">
									<span><%=basicInfo.testProj%></span>
								</div>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">检测周期(天):</label>
								<div class="layui-input-block">
									<span><%=basicInfo.testPeriod%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">要求完成日期:</label>
								<div class="layui-input-block">
									<span><%=basicInfo.completeDateLimit%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">试验性质:</label>
								<div class="layui-input-block">
									<span><%=basicInfo.testNature%></span>
								</div>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">项目类型:</label>
								<div class="layui-input-block">
									<span><%=basicInfo.projType%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">是否加急:</label>
								<div class="layui-input-block">
									<span><%=basicInfo.prior?'是':'否'%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">测试目的:</label>
								<div class="layui-input-block">
									<span><%=basicInfo.purpose%></span>
								</div>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">备注信息:</label>
								<div class="layui-input-block">
									<span><%=basicInfo.remark%></span>
								</div>
							</div>
						</div>
					</div>
					<div class="sampling">
						<div class="blueline">
							<div class="title"> 
								样品信息
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">委托单号:</label>
								<div class="layui-input-block">
									<span><%=sampleInfo.delegateNum%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">样品名称:</label>
								<div class="layui-input-block">
									<span><%=sampleInfo.sampleName%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">样品编号:</label>
								<div class="layui-input-block">
									<span><%=sampleInfo.sampleNumber%></span>
								</div>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">样品型号:</label>
								<div class="layui-input-block">
									<span><%=sampleInfo.sampleModel%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">样品数量:</label>
								<div class="layui-input-block">
									<span><%=sampleInfo.sampleAmount%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">样品规格:</label>
								<div class="layui-input-block">
									<span><%=sampleInfo.sampleSpecs%></span>
								</div>
							</div>
						</div>
					</div>
					<div class="plan">
						<div class="blueline">
							<div class="title"> 
								委托人信息
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">申请人:</label>
								<div class="layui-input-block">
									<span><%=delegateInfo.proposer%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">工号:</label>
								<div class="layui-input-block">
									<span><%=delegateInfo.staffNumber%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">创建时间:</label>
								<div class="layui-input-block">
									<span><%=delegateInfo.createTime%></span>
								</div>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">联系电话:</label>
								<div class="layui-input-block">
									<span><%=delegateInfo.phoneNumber%></span>
								</div>
							</div>
							<div class="layui-col-xs6 layui-col-sm6 layui-col-md4">
								<label class="layui-form-label">申请部门:</label>
								<div class="layui-input-block">
									<span><%=delegateInfo.proposerDepartment%></span>
								</div>
							</div>
						</div>
					</div>
					<div class="sign">
						<div class="blueline">
							<div class="title"> 
								授权签发
							</div>
						</div>
<!--						<div class="layui-form-item">-->
<!--							<div class="layui-col-xs12 layui-col-sm12 layui-col-md6">-->
<!--								<label class="layui-form-label">签发时间:</label>-->
<!--								<div class="layui-input-block">-->
<!--									<span type="text" class="layui-input" id="date" placeholder="yyyy-MM-dd"  lay-verify="required" autocomplete="off" disabled/>-->
<!--								</div>-->
<!--							</div>-->
<!--						</div>-->
						<div class="layui-form-item">
							<div class="layui-col-xs12 layui-col-sm12 layui-col-md6">
								<label class="layui-form-label">报告列表:</label>
								<div class="layui-input-block">
									<table class="layui-table">
									  <thead>
									    <tr>
									      <th>报告名称</th>
									      <th>操作</th>
									    </tr> 
									  </thead>
									  <tbody>
									  	<%if(reportList.length>0){%>
									  		<%for(var i=0;i<reportList.length;i++){%>
									  			<tr>
											      <td><%=reportList[i].fileName%></td>
											      <td>
													<%if(reportList[i].filePreviewUrl==""){%>
														<a class="layui-btn layui-btn-xs">转换中</a>
													<%}else{%>
														<a class="layui-btn layui-btn-xs" href="<%=reportList[i].filePreviewUrl%>" target="_blank">预览</a>
													<%}%>
														<a class="layui-btn layui-btn-xs" href="<%=reportList[i].fileUrl%>" target="_blank">Word文档</a>
												  </td>
											    </tr>
									  		<%}%>
									  	<%}%>
									  </tbody>
									</table>  
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
		<% include ../layout/footer.ejs %>
	</body>
	<script>
		href("/modular_task/reportaudit", "任务管理", "报告签发","签发")
		var delegateNum='<%=delegateNum%>'
		var subTaskNumber='<%=subTaskNumber%>'
		layui.use(['form', 'table','laydate','jquery'], function() {
			var form = layui.form
			var table = layui.table
			var laydate=layui.laydate
			var $=layui.jquery
			var date=new Date()
			var yy=date.getFullYear()
			var mm=date.getMonth()+1
			var dd=date.getDate()
			console.log(yy+'-'+mm+'-'+dd)
			var issuedate=''
			var $ = layui.$,
				active = {
					assign: function(index,layero) { //报告签发
						layer.open({
							type: 1,
							title:'签发',
							skin: 'layui-layer-rim', //加上边框
							area: ['420px', '280px'], //宽高
							content: '<div class="layui-col-xs11 layui-col-sm11" style="margin-top: 10px;">' +
									'<label class="layui-form-label"><span class="i">*</span>签发时间:</label>' +
									'<div class="layui-input-block">' +
									'<input type="text" class="layui-input" id="layerDate" placeholder="yyyy-MM-dd"  lay-verify="required" autocomplete="off"/>' +
									'</div>' +
									'</div>'+
									'<div class="layui-col-xs11 layui-col-sm11">' +
									'<label class="layui-form-label">签发备注:</label>'+
									'<div class="layui-input-block">'+
									'<textarea class="layui-textarea remark" placeholder="报告签发备注" rows="" cols=""></textarea>'+
									'</div>'+
									'</div>',
							success: function () {
								laydate.render({
									elem: '#layerDate'
									,max: yy+'-'+mm+'-'+dd
									,trigger: 'click'
									,done: function(value, date, endDate){
										//alert(value); 得到日期生成的值，如：2017-08-18
										issuedate=value
									}
								});//日期范围
							},
							btn: ['确定','取消'],
							btn1:function(){
								if (!issuedate) {
									layer.msg("签发时间不能为空");
									return;
								}
								$.ajax({
									url:'/modular_task/confirmIssueReport?delegateNum='+delegateNum+'&subTaskNumber='+subTaskNumber+'&remark='+$(".remark").val()+'&date='+issuedate,
									type:'GET',
									success:function(res){
										console.log(res)
										if(res.status=="ok"){
											layer.close(index);
			                				window.location.href="/modular_task/reportIssue"
											parent.layer.msg(res.message);
										}
									}
								});
							},
							btn2:function(){
//								alert("2")
							},
						});
					},
				}
			$('.layui-btn').on('click', function() {
				var type = $(this).data('type');
				active[type] ? active[type].call(this) : '';
			});
		});
	</script>
</html>